{"version":3,"sources":["../../../../../build/webpack/plugins/wellknown-errors-plugin/webpackModuleError.ts"],"names":["getFileData","compilation","m","resolved","ctx","compiler","context","resource","res","path","relative","replace","posix","sep","startsWith","requestShortener","readableIdentifier","request","userRequest","content","resolve","getModuleBuildError","input","name","Boolean","module","error","Error","err","sourceFilename","sourceContent","babel","css","scss"],"mappings":"qFAAA,sBACA,kDAGA,wCACA,oCACA,sC,qzBAGA,QAASA,CAAAA,WAAT,CACEC,WADF,CAEEC,CAFF,CAG2B,uDACzB,GAAIC,CAAAA,QAAJ,CACA,GAAIC,CAAAA,GAAkB,sDACpBH,WAAW,CAACI,QADQ,iDACpB,uBAAsBC,OADF,+DACaL,WAAW,CAACK,OADzB,6BACoC,IAD1D,CAEA,GAAIF,GAAG,GAAK,IAAR,EAAgB,MAAOF,CAAAA,CAAC,CAACK,QAAT,GAAsB,QAA1C,CAAoD,CAClD,KAAMC,CAAAA,GAAG,CAAGC,IAAI,CAACC,QAAL,CAAcN,GAAd,CAAmBF,CAAC,CAACK,QAArB,EAA+BI,OAA/B,CAAuC,KAAvC,CAA8CF,IAAI,CAACG,KAAL,CAAWC,GAAzD,CAAZ,CACAV,QAAQ,CAAGK,GAAG,CAACM,UAAJ,CAAe,GAAf,EAAsBN,GAAtB,CAA6B,IAAGC,IAAI,CAACG,KAAL,CAAWC,GAAI,GAAEL,GAAI,EAAhE,CACD,CAHD,IAGO,CACL,KAAMO,CAAAA,gBAAgB,CAAGd,WAAW,CAACc,gBAArC,CACA,GAAI,OAAOb,CAAP,SAAOA,CAAP,iBAAOA,CAAC,CAAEc,kBAAV,IAAiC,UAArC,CAAiD,CAC/Cb,QAAQ,CAAGD,CAAC,CAACc,kBAAF,CAAqBD,gBAArB,CAAX,CACD,CAFD,IAEO,gBACLZ,QAAQ,aAAGD,CAAC,CAACe,OAAL,yCAAgBf,CAAC,CAACgB,WAA1B,CACD,CACF,CAED,GAAIf,QAAJ,CAAc,CACZ,GAAIgB,CAAAA,OAAsB,CAAG,IAA7B,CACA,GAAI,CACFA,OAAO,CAAG,qBACRf,GAAG,CAAGK,IAAI,CAACW,OAAL,CAAahB,GAAb,CAAkBD,QAAlB,CAAH,CAAiCA,QAD5B,CAER,MAFQ,CAAV,CAID,CAAC,cAAM,CAAE,CACV,MAAO,CAACA,QAAD,CAAWgB,OAAX,CAAP,CACD,CAED,MAAO,CAAC,WAAD,CAAc,IAAd,CAAP,CACD,CAEM,QAASE,CAAAA,mBAAT,CACLpB,WADK,CAELqB,KAFK,CAGuB,CAC5B,GACE,EACE,MAAOA,CAAAA,KAAP,GAAiB,QAAjB,EACA,CAAAA,KAAK,OAAL,EAAAA,KAAK,SAAL,QAAAA,KAAK,CAAEC,IAAP,IAAgB,kBADhB,EAEAC,OAAO,CAACF,KAAK,CAACG,MAAP,CAFP,EAGAH,KAAK,CAACI,KAAN,WAAuBC,CAAAA,KAJzB,CADF,CAOE,CACA,MAAO,MAAP,CACD,CAED,KAAMC,CAAAA,GAAU,CAAGN,KAAK,CAACI,KAAzB,CACA,KAAM,CAACG,cAAD,CAAiBC,aAAjB,EAAkC9B,WAAW,CAACC,WAAD,CAAcqB,KAAK,CAACG,MAApB,CAAnD,CAEA,KAAMM,CAAAA,KAAK,CAAG,8BAAcF,cAAd,CAA8BD,GAA9B,CAAd,CACA,GAAIG,KAAK,GAAK,KAAd,CAAqB,CACnB,MAAOA,CAAAA,KAAP,CACD,CAED,KAAMC,CAAAA,GAAG,CAAG,0BAAYH,cAAZ,CAA4BD,GAA5B,CAAZ,CACA,GAAII,GAAG,GAAK,KAAZ,CAAmB,CACjB,MAAOA,CAAAA,GAAP,CACD,CAED,KAAMC,CAAAA,IAAI,CAAG,4BAAaJ,cAAb,CAA6BC,aAA7B,CAA4CF,GAA5C,CAAb,CACA,GAAIK,IAAI,GAAK,KAAb,CAAoB,CAClB,MAAOA,CAAAA,IAAP,CACD,CAED,MAAO,MAAP,CACD","sourcesContent":["import { readFileSync } from 'fs'\nimport * as path from 'path'\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { compilation as CompilationType } from 'webpack'\nimport { getBabelError } from './parseBabel'\nimport { getCssError } from './parseCss'\nimport { getScssError } from './parseScss'\nimport { SimpleWebpackError } from './simpleWebpackError'\n\nfunction getFileData(\n  compilation: CompilationType.Compilation,\n  m: any\n): [string, string | null] {\n  let resolved: string\n  let ctx: string | null =\n    compilation.compiler?.context ?? compilation.context ?? null\n  if (ctx !== null && typeof m.resource === 'string') {\n    const res = path.relative(ctx, m.resource).replace(/\\\\/g, path.posix.sep)\n    resolved = res.startsWith('.') ? res : `.${path.posix.sep}${res}`\n  } else {\n    const requestShortener = compilation.requestShortener\n    if (typeof m?.readableIdentifier === 'function') {\n      resolved = m.readableIdentifier(requestShortener)\n    } else {\n      resolved = m.request ?? m.userRequest\n    }\n  }\n\n  if (resolved) {\n    let content: string | null = null\n    try {\n      content = readFileSync(\n        ctx ? path.resolve(ctx, resolved) : resolved,\n        'utf8'\n      )\n    } catch {}\n    return [resolved, content]\n  }\n\n  return ['<unknown>', null]\n}\n\nexport function getModuleBuildError(\n  compilation: CompilationType.Compilation,\n  input: any\n): SimpleWebpackError | false {\n  if (\n    !(\n      typeof input === 'object' &&\n      input?.name === 'ModuleBuildError' &&\n      Boolean(input.module) &&\n      input.error instanceof Error\n    )\n  ) {\n    return false\n  }\n\n  const err: Error = input.error\n  const [sourceFilename, sourceContent] = getFileData(compilation, input.module)\n\n  const babel = getBabelError(sourceFilename, err)\n  if (babel !== false) {\n    return babel\n  }\n\n  const css = getCssError(sourceFilename, err)\n  if (css !== false) {\n    return css\n  }\n\n  const scss = getScssError(sourceFilename, sourceContent, err)\n  if (scss !== false) {\n    return scss\n  }\n\n  return false\n}\n"]}